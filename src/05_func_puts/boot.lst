     1                                  BOOT_LOAD equ 0x7C00		;ÉuÅ[ÉgÉvÉçÉOÉâÉÄÇÃÉçÅ[Éhà íu
     2                                  
     3                                  ORG BOOT_LOAD			;ÉçÅ[ÉhÉAÉhÉåÉXÇÉAÉZÉìÉuÉâÇ…éwé¶ (1ìxÇµÇ©éwé¶Ç≈Ç´Ç»Ç¢)
     4                                  
     5                                  ;------------------------
     6                                  ;ÅyÉ}ÉNÉçÅz
     7                                  ;------------------------
     8                                  %include "..\include\macro.s"
     1                              <1> %macro cdecl 1-*.noilst
     2                              <1> 
     3                              <1>         %rep %0 - 1
     4                              <1>             push %{-1:-1}
     5                              <1>             %rotate -1
     6                              <1>         %endrep
     7                              <1>         %rotate -1
     8                              <1>         call %1
     9                              <1> 
    10                              <1>     %if 1 < %0
    11                              <1>         add sp,(__BITS__ >> 3) * (%0 -1)
    12                              <1>     %endif
    13                              <1> 
    14                              <1> %endmacro
     9                                  
    10                                  ;****************************************************
    11                                  ;ÅyÉGÉìÉgÉäÉ|ÉCÉìÉgÅz
    12                                  ;****************************************************
    13                                  
    14                                  entry:
    15                                  
    16                                  
    17                                  ;----------------------------
    18                                  ;ÅyBPB(BIOS Parameter Block)Åz
    19                                  ;----------------------------
    20 00000000 EB58                    jmp	ipl		;IPLÇ÷ÉWÉÉÉìÉv
    21 00000002 90<rept>                times 90 - ($ - $$) db 0x90
    22                                  
    23                                  
    24                                  ;----------------------------
    25                                  ;ÅyIPL(Initial Program Loader)Åz
    26                                  ;----------------------------
    27                                  ipl:
    28 0000005A FA                      	cli			;äÑÇËçûÇ›èàóùÇ…ç°ÇÕëŒâûÇµÇƒÇ¢Ç»Ç¢ÇÃÇ≈ÅAäÑÇËçûÇ›èàóùÇã÷é~Ç…Ç∑ÇÈ
    29                                  	
    30 0000005B B80000                  	mov ax,0x0000		;AX = 0x0000
    31 0000005E 8ED8                    	mov ds,ax		;DS = 0x0000
    32 00000060 8EC0                    	mov es,ax		;ES = 0x0000
    33 00000062 8ED0                    	mov ss,ax		;SS = 0x0000
    34 00000064 BC007C                  	mov sp,BOOT_LOAD	;SP = 0x7C00
    35                                  
    36 00000067 FB                      	sti			;äÑÇËçûÇ›ãñâ¬
    37                                  
    38 00000068 8816[8400]              	mov [BOOT.DRIVE],dl	;ÉuÅ[ÉgÉhÉâÉCÉuÇï€ë∂
    39                                  	
    40                                  	;----------------
    41                                  	;ï∂éöóÒÇï\é¶
    42                                  	;----------------
    43                                  	cdecl puts,.s0		;puts(.s0)
    43                              <1> 
    43                              <1>  %rep %0 - 1
    43                              <1>  push %-1:-1
    43                              <1>  %rotate -1
    43                              <1>  %endrep
    43 0000006C 68[7700]            <2>  push %-1:-1
    43                              <2>  %rotate -1
    43                              <1>  %rotate -1
    43 0000006F E81400              <1>  call %1
    43                              <1> 
    43                              <1>  %if 1 < %0
    43 00000072 83C402              <1>  add sp,(__BITS__ >> 3) * (%0 -1)
    43                              <1>  %endif
    43                              <1> 
    44                                  
    45                                  	;----------------
    46                                  	;èàóùÇÃèIóπ
    47                                  	;----------------
    48 00000075 EBFE                    	jmp $			;while(1); // ñ≥å¿ÉãÅ[Év
    49                                  
    50                                  ;----------------
    51                                  ;ï∂éöóÒÇÃï\é¶Ç≈ï\é¶Ç∑ÇÈÉfÅ[É^
    52                                  ;----------------
    53 00000077 426F6F74696E672E2E-     .s0	db "Booting...",0x0A,0x0D,0		;//	.s0 = "Booting..." +"0x0A(ÉâÉCÉìÉtÉBÅ[Éh)"+"0x0D(ÉLÉÉÉäÉbÉWÉäÉ^Å[Éì)";
    53 00000080 2E0A0D00           
    54                                  
    55                                  ALIGN 2,db 0			;ÉfÅ[É^Ç2ÉoÉCÉgã´äEÇ≈îzíuÇ∑ÇÈÇÊÇ§Ç…éwé¶
    56                                  BOOT:				;ÉuÅ[ÉgÉhÉâÉCÉuÇ…ä÷Ç∑ÇÈèÓïÒ
    57 00000084 0000                    .DRIVE:		dw 0		;ÉhÉâÉCÉuî‘çÜ
    58                                  
    59                                  ;------------------------
    60                                  ;ÅyÉÇÉWÉÖÅ[ÉãÅz
    61                                  ;------------------------
    62                                  %include "..\modules\real\puts.s"
     1                              <1> ;************************
     2                              <1> ; void puts(str)
     3                              <1> ;************************
     4                              <1> ; Êàª„ÇäÂÄ§ | „Å™„Åó
     5                              <1> ; str	 | ÊñáÂ≠óÂàó„Ç¢„Éâ„É¨„Çπ
     6                              <1> ;************************
     7                              <1> 
     8                              <1> puts:
     9                              <1> 
    10                              <1> ;------------------------
    11                              <1> ;„Äê„Çπ„Çø„ÉÉ„ÇØ„Éï„É¨„Éº„É†„ÅÆÊßãÁØâ„Äë
    12                              <1> ;------------------------
    13                              <1> ; +4 	 | ÊñáÂ≠óÂàó„Å∏„ÅÆ„Ç¢„Éâ„É¨„Çπ
    14                              <1> ; +2 	 | IP(Êàª„ÇäÁï™Âú∞)
    15                              <1> ; BP + 0 | BP(ÂÖÉ„ÅÆÂÄ§)
    16                              <1> ;--------|------------
    17                              <1> 
    18 00000086 55                  <1> push bp
    19 00000087 89E5                <1> mov bp,sp
    20                              <1> 
    21                              <1> ;------------------------
    22                              <1> ;„Äê„É¨„Ç∏„Çπ„Çø„ÅÆ‰øùÂ≠ò„Äë
    23                              <1> ;------------------------
    24 00000089 50                  <1> push ax
    25 0000008A 53                  <1> push bx
    26 0000008B 56                  <1> push si
    27                              <1> 
    28                              <1> ;------------------------
    29                              <1> ;„ÄêÂºïÊï∞„ÇíÂèñÂæó„Äë
    30                              <1> ;------------------------
    31 0000008C 8B7604              <1> mov si,[bp + 4]
    32                              <1> 
    33                              <1> ;------------------------
    34                              <1> ;„ÄêÂá¶ÁêÜ„ÅÆÈñãÂßã„Äë
    35                              <1> ;------------------------
    36 0000008F B40E                <1> mov ah,0x0E
    37 00000091 BB0000              <1> mov bx,0x0000
    38 00000094 FC                  <1> cld         ;DF„Éï„É©„Ç∞„Çí0„Å´Ë®≠ÂÆö„Åó„Å¶„ÄÅ[lodsbÂëΩ‰ª§„ÅÆÊôÇ„Å´]„Ç¢„Éâ„É¨„Çπ„ÇíÂä†ÁÆó
    39                              <1> 
    40                              <1> .10L:       ;do{
    41 00000095 AC                  <1> lodsb       ;   AL = *SI++;
    42 00000096 3C00                <1> cmp al,0    ;   if(0 == AL)
    43 00000098 7404                <1> je  .10E    ;       break;
    44 0000009A CD10                <1> int 0x10    ;   Int10(0x0E,AL); // ÊñáÂ≠óÂá∫Âäõ
    45 0000009C EBF7                <1> jmp .10L    ;
    46                              <1> .10E:       ;}while(1);
    47                              <1> ;------------------------
    48                              <1> ;„Äê„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞„Äë
    49                              <1> ;------------------------
    50 0000009E 5E                  <1> pop si
    51 0000009F 5B                  <1> pop bx
    52 000000A0 58                  <1> pop ax
    53                              <1> ;------------------------
    54                              <1> ;„Äê„Çπ„Çø„ÉÉ„ÇØ„Éï„É¨„Éº„É†„ÅÆÁ†¥Ê£Ñ„Äë
    55                              <1> ;------------------------
    56 000000A1 89EC                <1> mov sp,bp
    57 000000A3 5D                  <1> pop bp
    58                              <1> 
    59 000000A4 C3                  <1> ret
    63                                  
    64                                  
    65                                  ;****************************************************
    66                                  ;ÅyÉuÅ[ÉgÉtÉâÉOÅz(êÊì™512ÉoÉCÉgÇÃèIóπ)
    67                                  ;****************************************************
    68 000000A5 00<rept>                times 510 - ($ - $$) db 0x00
    69 000001FE 55AA                    db 0x55,0xAA
