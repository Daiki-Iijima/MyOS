     1                                  BOOT_LOAD equ 0x7C00		;ÉuÅ[ÉgÉvÉçÉOÉâÉÄÇÃÉçÅ[Éhà íu
     2                                  
     3                                  ORG BOOT_LOAD			;ÉçÅ[ÉhÉAÉhÉåÉXÇÉAÉZÉìÉuÉâÇ…éwé¶ (1ìxÇµÇ©éwé¶Ç≈Ç´Ç»Ç¢)
     4                                  
     5                                  ;------------------------
     6                                  ;ÅyÉ}ÉNÉçÅz
     7                                  ;------------------------
     8                                  %include "..\include\macro.s"
     1                              <1> %macro cdecl 1-*.noilst
     2                              <1> 
     3                              <1>         %rep %0 - 1
     4                              <1>             push %{-1:-1}
     5                              <1>             %rotate -1
     6                              <1>         %endrep
     7                              <1>         %rotate -1
     8                              <1>         call %1
     9                              <1> 
    10                              <1>     %if 1 < %0
    11                              <1>         add sp,(__BITS__ >> 3) * (%0 -1)
    12                              <1>     %endif
    13                              <1> 
    14                              <1> %endmacro
     9                                  
    10                                  ;****************************************************
    11                                  ;ÅyÉGÉìÉgÉäÉ|ÉCÉìÉgÅz
    12                                  ;****************************************************
    13                                  
    14                                  entry:
    15                                  
    16                                  
    17                                  ;----------------------------
    18                                  ;ÅyBPB(BIOS Parameter Block)Åz
    19                                  ;----------------------------
    20 00000000 EB58                    jmp	ipl		;IPLÇ÷ÉWÉÉÉìÉv
    21 00000002 90<rept>                times 90 - ($ - $$) db 0x90
    22                                  
    23                                  
    24                                  ;----------------------------
    25                                  ;ÅyIPL(Initial Program Loader)Åz
    26                                  ;----------------------------
    27                                  ipl:
    28 0000005A FA                      	cli			;äÑÇËçûÇ›èàóùÇ…ç°ÇÕëŒâûÇµÇƒÇ¢Ç»Ç¢ÇÃÇ≈ÅAäÑÇËçûÇ›èàóùÇã÷é~Ç…Ç∑ÇÈ
    29                                  	
    30 0000005B B80000                  	mov ax,0x0000		;AX = 0x0000
    31 0000005E 8ED8                    	mov ds,ax		;DS = 0x0000
    32 00000060 8EC0                    	mov es,ax		;ES = 0x0000
    33 00000062 8ED0                    	mov ss,ax		;SS = 0x0000
    34 00000064 BC007C                  	mov sp,BOOT_LOAD	;SP = 0x7C00
    35                                  
    36 00000067 FB                      	sti			;äÑÇËçûÇ›ãñâ¬
    37                                  
    38 00000068 8816[8C00]              	mov [BOOT.DRIVE],dl	;ÉuÅ[ÉgÉhÉâÉCÉuÇï€ë∂
    39                                  	
    40                                  	;----------------
    41                                  	;ï∂éöóÒÇï\é¶
    42                                  	;----------------
    43                                  	cdecl puts,.s0		;puts(.s0)
    43                              <1> 
    43                              <1>  %rep %0 - 1
    43                              <1>  push %-1:-1
    43                              <1>  %rotate -1
    43                              <1>  %endrep
    43 0000006C 68[7F00]            <2>  push %-1:-1
    43                              <2>  %rotate -1
    43                              <1>  %rotate -1
    43 0000006F E81C00              <1>  call %1
    43                              <1> 
    43                              <1>  %if 1 < %0
    43 00000072 83C402              <1>  add sp,(__BITS__ >> 3) * (%0 -1)
    43                              <1>  %endif
    43                              <1> 
    44                                  	cdecl reboot		;Ç±Ç±Ç≈ÉãÅ[ÉvÇ∑ÇÈ
    44                              <1> 
    44                              <1>  %rep %0 - 1
    44                              <1>  push %-1:-1
    44                              <1>  %rotate -1
    44                              <1>  %endrep
    44                              <2>  push %-1:-1
    44          ******************  <2>  error: symbol `ipl.noilst' undefined
    44                              <2>  %rotate -1
    44                              <1>  %rotate -1
    44 00000075 E83500              <1>  call %1
    44                              <1> 
    44                              <1>  %if 1 < %0
    44 00000078 83C402              <1>  add sp,(__BITS__ >> 3) * (%0 -1)
    44                              <1>  %endif
    44                              <1> 
    45                                  	
    46                                  	;----------------
    47                                  	;èàóùÇÃèIóπ
    48                                  	;----------------
    49 0000007B EBFE                    	jmp $			;while(1); // ñ≥å¿ÉãÅ[Év
    50                                  
    51                                  ;----------------
    52                                  ;ï∂éöóÒÇÃï\é¶Ç≈ï\é¶Ç∑ÇÈÉfÅ[É^
    53                                  ;----------------
    54 0000007D 426F6F74696E672E2E-     .s0	db "Booting...",0x0A,0x0D,0		;//	.s0 = "Booting..." +"0x0A(ÉâÉCÉìÉtÉBÅ[Éh)"+"0x0D(ÉLÉÉÉäÉbÉWÉäÉ^Å[Éì)";
    54          ******************       error: label `ipl.s0' changed during code generation [-w+error=label-redef-late]
    54 00000086 2E0A0D00           
    55                                  
    56                                  ALIGN 2,db 0			;ÉfÅ[É^Ç2ÉoÉCÉgã´äEÇ≈îzíuÇ∑ÇÈÇÊÇ§Ç…éwé¶
    57                                  BOOT:				;ÉuÅ[ÉgÉhÉâÉCÉuÇ…ä÷Ç∑ÇÈèÓïÒ
    57          ******************       error: label `BOOT' changed during code generation [-w+error=label-redef-late]
    58 0000008A 0000                    .DRIVE:		dw 0		;ÉhÉâÉCÉuî‘çÜ
    58          ******************       error: label `BOOT.DRIVE' changed during code generation [-w+error=label-redef-late]
    59                                  
    60                                  ;------------------------
    61                                  ;ÅyÉÇÉWÉÖÅ[ÉãÅz
    62                                  ;------------------------
    63                                  %include "..\modules\real\puts.s"
     1                              <1> ;************************
     2                              <1> ; void puts(str)
     3                              <1> ;************************
     4                              <1> ; Êàª„ÇäÂÄ§ | „Å™„Åó
     5                              <1> ; str	 | ÊñáÂ≠óÂàó„Ç¢„Éâ„É¨„Çπ
     6                              <1> ;************************
     7                              <1> 
     8                              <1> puts:
     8          ******************  <1>  error: label `puts' changed during code generation [-w+error=label-redef-late]
     9                              <1> 
    10                              <1> ;------------------------
    11                              <1> ;„Äê„Çπ„Çø„ÉÉ„ÇØ„Éï„É¨„Éº„É†„ÅÆÊßãÁØâ„Äë
    12                              <1> ;------------------------
    13                              <1> ; +4 	 | ÊñáÂ≠óÂàó„Å∏„ÅÆ„Ç¢„Éâ„É¨„Çπ
    14                              <1> ; +2 	 | IP(Êàª„ÇäÁï™Âú∞)
    15                              <1> ; BP + 0 | BP(ÂÖÉ„ÅÆÂÄ§)
    16                              <1> ;--------|------------
    17                              <1> 
    18 0000008C 55                  <1> push bp
    19 0000008D 89E5                <1> mov bp,sp
    20                              <1> 
    21                              <1> ;------------------------
    22                              <1> ;„Äê„É¨„Ç∏„Çπ„Çø„ÅÆ‰øùÂ≠ò„Äë
    23                              <1> ;------------------------
    24 0000008F 50                  <1> push ax
    25 00000090 53                  <1> push bx
    26 00000091 56                  <1> push si
    27                              <1> 
    28                              <1> ;------------------------
    29                              <1> ;„ÄêÂºïÊï∞„ÇíÂèñÂæó„Äë
    30                              <1> ;------------------------
    31 00000092 8B7604              <1> mov si,[bp + 4]
    32                              <1> 
    33                              <1> ;------------------------
    34                              <1> ;„ÄêÂá¶ÁêÜ„ÅÆÈñãÂßã„Äë
    35                              <1> ;------------------------
    36 00000095 B40E                <1> mov ah,0x0E
    37 00000097 BB0000              <1> mov bx,0x0000
    38 0000009A FC                  <1> cld         ;DF„Éï„É©„Ç∞„Çí0„Å´Ë®≠ÂÆö„Åó„Å¶„ÄÅ[lodsbÂëΩ‰ª§„ÅÆÊôÇ„Å´]„Ç¢„Éâ„É¨„Çπ„ÇíÂä†ÁÆó
    39                              <1> 
    40                              <1> .10L:       ;do{
    40          ******************  <1>  error: label `puts.10L' changed during code generation [-w+error=label-redef-late]
    41 0000009B AC                  <1> lodsb       ;   AL = *SI++;
    42 0000009C 3C00                <1> cmp al,0    ;   if(0 == AL)
    43 0000009E 7406                <1> je  .10E    ;       break;
    44 000000A0 CD10                <1> int 0x10    ;   Int10(0x0E,AL); // ÊñáÂ≠óÂá∫Âäõ
    45 000000A2 EBF7                <1> jmp .10L    ;
    46                              <1> .10E:       ;}while(1); //aaaaaaaaaaaaaaaaaaaaaaaaaaa
    46          ******************  <1>  error: label `puts.10E' changed during code generation [-w+error=label-redef-late]
    47                              <1> ;------------------------
    48                              <1> ;„Äê„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞„Äë
    49                              <1> ;------------------------
    50 000000A4 5E                  <1> pop si
    51 000000A5 5B                  <1> pop bx
    52 000000A6 58                  <1> pop ax
    53                              <1> ;------------------------
    54                              <1> ;„Äê„Çπ„Çø„ÉÉ„ÇØ„Éï„É¨„Éº„É†„ÅÆÁ†¥Ê£Ñ„Äë
    55                              <1> ;------------------------
    56 000000A7 89EC                <1> mov sp,bp
    57 000000A9 5D                  <1> pop bp
    58                              <1> 
    59 000000AA C3                  <1> ret
    64                                  %include "..\modules\real\reboot.s"
     1                              <1> reboot:
     1          ******************  <1>  error: label `reboot' changed during code generation [-w+error=label-redef-late]
     2                              <1> ;------------------
     3                              <1> ;„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
     4                              <1> ;------------------
     5                              <1> cdecl puts, .s0
     5                              <2> 
     5                              <2>  %rep %0 - 1
     5                              <2>  push %-1:-1
     5                              <2>  %rotate -1
     5                              <2>  %endrep
     5 000000AB 68[C900]            <3>  push %-1:-1
     5                              <3>  %rotate -1
     5                              <2>  %rotate -1
     5 000000AE E8DBFF              <2>  call %1
     5                              <2> 
     5                              <2>  %if 1 < %0
     5 000000B1 83C402              <2>  add sp,(__BITS__ >> 3) * (%0 -1)
     5                              <2>  %endif
     5                              <2> 
     6                              <1> 
     7                              <1> ;------------------
     8                              <1> ;„Ç≠„Éº„ÅÆÂÖ•ÂäõÂæÖ„Å°
     9                              <1> ;intÂëΩ‰ª§ : Ââ≤„ÇäËæº„Åø„Éè„É≥„Éâ„É©„ÄÅ‰æãÂ§ñ„Éè„É≥„Éâ„É©„ÇíÂëº„Å≥Âá∫„Åô
    10                              <1> ;          BIOS„Å´Áî®ÊÑè„Åï„Çå„ÅüÈñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åô„Ç§„É°„Éº„Ç∏
    11                              <1> ;------------------
    12                              <1> .10L:           ;do{
    12          ******************  <1>  error: label `reboot.10L' changed during code generation [-w+error=label-redef-late]
    13 000000B4 B410                <1>     mov ah,0x10 ;   „Ç≠„ÉºÂÖ•ÂäõÂæÖ„Å°
    14 000000B6 CD16                <1>     int 0x16    ;   AL = BIOS(0x16,0x10);
    15                              <1> 
    16 000000B8 3C20                <1>     cmp al,' '   ;   ZF == AL == '';//„Çπ„Éö„Éº„Çπ„ÇíÊäº„Åó„ÅüÂ†¥Âêà
    17 000000BA 75F8                <1>     jne .10L    ;}while(!ZF);
    18                              <1> 
    19                              <1> ;------------------
    20                              <1> ;ÊîπË°å„ÇíÂá∫Âäõ
    21                              <1> ;------------------
    22                              <1> cdecl puts, .s1   ;   ÊîπË°å
    22                              <2> 
    22                              <2>  %rep %0 - 1
    22                              <2>  push %-1:-1
    22                              <2>  %rotate -1
    22                              <2>  %endrep
    22 000000BC 68[E700]            <3>  push %-1:-1
    22                              <3>  %rotate -1
    22                              <2>  %rotate -1
    22 000000BF E8CAFF              <2>  call %1
    22                              <2> 
    22                              <2>  %if 1 < %0
    22 000000C2 83C402              <2>  add sp,(__BITS__ >> 3) * (%0 -1)
    22                              <2>  %endif
    22                              <2> 
    23                              <1> 
    24                              <1> ;------------------
    25                              <1> ;ÂÜçËµ∑Âãï
    26                              <1> ;------------------
    27 000000C5 CD19                <1> int 0x19        ;   BIOS(0x19); //reboot()
    28                              <1> 
    29                              <1> ;------------------
    30                              <1> ;ÊîπË°å„ÇíÂá∫Âäõ
    31                              <1> ;------------------
    32 000000C7 0A0D50757368205350- <1> .s0 db 0x0A,0x0D,"Push SPACE key to reboot...",0
    32          ******************  <1>  error: label `reboot.s0' changed during code generation [-w+error=label-redef-late]
    32 000000D0 414345206B65792074- <1>
    32 000000D9 6F207265626F6F742E- <1>
    32 000000E2 2E2E00              <1>
    33 000000E5 0A0D0A0D00          <1> .s1 db 0x0A,0x0D,0x0A,0x0D,0
    33          ******************  <1>  error: label `reboot.s1' changed during code generation [-w+error=label-redef-late]
    65                                  
    66                                  
    67                                  ;****************************************************
    68                                  ;ÅyÉuÅ[ÉgÉtÉâÉOÅz(êÊì™512ÉoÉCÉgÇÃèIóπ)
    69                                  ;****************************************************
    70 000000EA 00<rept>                times 510 - ($ - $$) db 0x00
    71 000001FE 55AA                    db 0x55,0xAA
