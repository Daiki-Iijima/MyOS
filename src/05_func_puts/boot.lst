     1                                  BOOT_LOAD equ 0x7C00		;ブートプログラムのロード位置
     2                                  
     3                                  ORG BOOT_LOAD			;ロードアドレスをアセンブラに指示 (1度しか指示できない)
     4                                  
     5                                  ;****************************************************
     6                                  ;【エントリポイント】
     7                                  ;****************************************************
     8                                  
     9                                  entry:
    10                                  
    11                                  
    12                                  ;----------------------------
    13                                  ;【BPB(BIOS Parameter Block)】
    14                                  ;----------------------------
    15 00000000 EB58                    jmp	ipl		;IPLへジャンプ
    16 00000002 90<rept>                times 90 - ($ - $$) db 0x90
    17                                  
    18                                  
    19                                  ;----------------------------
    20                                  ;【IPL(Initial Program Loader)】
    21                                  ;----------------------------
    22                                  ipl:
    23 0000005A FA                      	cli			;割り込み処理に今は対応していないので、割り込み処理を禁止にする
    24                                  	
    25 0000005B B80000                  	mov ax,0x0000		;AX = 0x0000
    26 0000005E 8ED8                    	mov ds,ax		;DS = 0x0000
    27 00000060 8EC0                    	mov es,ax		;ES = 0x0000
    28 00000062 8ED0                    	mov ss,ax		;SS = 0x0000
    29 00000064 BC007C                  	mov sp,BOOT_LOAD	;SP = 0x7C00
    30                                  
    31 00000067 FB                      	sti			;割り込み許可
    32                                  
    33 00000068 8816[8600]              	mov [BOOT.DRIVE],dl	;ブートドライブを保存
    34                                  	
    35                                  	
    36 0000006C 6A41                    	push word 'A'
    37 0000006E E81700                  	call putc
    38 00000071 83C402                  	add sp,2
    39                                  
    40 00000074 6A42                    	push word 'B'
    41 00000076 E80F00                  	call putc
    42 00000079 83C402                  	add sp,2
    43                                  
    44 0000007C 6A43                    	push word 'C'
    45 0000007E E80700                  	call putc
    46 00000081 83C402                  	add sp,2
    47                                  
    48 00000084 EBFE                    	jmp $			;while(1); // 無限ループ
    49                                  
    50                                  ALIGN 2,db 0			;データを2バイト境界で配置するように指示
    51                                  BOOT:				;ブートドライブに関する情報
    52 00000086 0000                    .DRIVE:		dw 0		;ドライブ番号
    53                                  
    54                                  
    55                                  ;------------------------
    56                                  ;【モジュール】
    57                                  ;------------------------
    58                                  %include "..\modules\real\putc.s"
     1                              <1> ;************************
     2                              <1> ; void putc(ch)
     3                              <1> ;************************
     4                              <1> ; 戻り値 | なし
     5                              <1> ; ch	 | 文字コード
     6                              <1> ;************************
     7                              <1> 
     8                              <1> putc:
     9                              <1> ;------------------------
    10                              <1> ;【スタックフレームの構築】
    11                              <1> ;------------------------
    12                              <1> ; +4 	 | 出力文字
    13                              <1> ; +2 	 | IP(戻り番地)
    14                              <1> ; BP + 0 | BP(元の値)
    15                              <1> ;--------|------------
    16                              <1> 
    17 00000088 55                  <1> push bp
    18 00000089 89E5                <1> mov  bp,sp
    19                              <1> 
    20                              <1> ;------------------------
    21                              <1> ;【レジスタの保存】
    22                              <1> ;------------------------
    23 0000008B 50                  <1> push ax
    24 0000008C 53                  <1> push bx
    25                              <1> 
    26                              <1> 
    27                              <1> ;------------------------
    28                              <1> ;【処理の開始】
    29                              <1> ;------------------------
    30 0000008D 8A4604              <1> mov al,[bp + 4]		;出力文字を設定
    31 00000090 B40E                <1> mov ah,0x0E		;テレタイプ式1文字を出力
    32 00000092 BB0000              <1> mov bx,0x0000		;ページ番号と文字色を0に設定
    33 00000095 CD10                <1> int 0x10		;ビデオBIOSコール
    34                              <1> 
    35                              <1> 
    36                              <1> ;------------------------
    37                              <1> ;【レジスタの復帰】
    38                              <1> ;------------------------
    39 00000097 5B                  <1> pop bx
    40 00000098 58                  <1> pop ax
    41                              <1> 
    42                              <1> 
    43                              <1> ;------------------------
    44                              <1> ;【スタックフレームの破棄】
    45                              <1> ;------------------------
    46 00000099 89EC                <1> mov sp,bp
    47 0000009B 5D                  <1> pop bp
    48                              <1> 
    49 0000009C C3                  <1> ret
    59                                  
    60                                  ;****************************************************
    61                                  ;【ブートフラグ】(先頭512バイトの終了)
    62                                  ;****************************************************
    63 0000009D 00<rept>                times 510 - ($ - $$) db 0x00
    64 000001FE 55AA                    db 0x55,0xAA
